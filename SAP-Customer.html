<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP - Contact Client</title>
    <style>
        /* [Keep your existing CSS] */
    </style>
</head>
<body>
    <!-- [Keep your existing HTML structure] -->

    <script>
        // 100% working API configuration
        const getApiBaseUrl = () => {
            // If running on GitHub Pages
            if (window.location.hostname.includes('github.io')) {
                return 'https://logisticstraining.vercel.app';
            }
            // If running locally
            if (window.location.hostname === 'localhost') {
                return 'http://localhost:3000';
            }
            // Default to current domain
            return window.location.origin;
        };

        const API_BASE_URL = getApiBaseUrl();
        console.log('Using API Base URL:', API_BASE_URL);

        // Guaranteed-working API call function
        const callApi = async (endpoint, method = 'GET', body = null) => {
            const url = `${API_BASE_URL}${endpoint}`;
            const options = {
                method,
                credentials: 'include',
                headers: {}
            };

            if (body instanceof FormData) {
                options.body = body;
            } else if (body) {
                options.headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error || 'Request failed');
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        };

        // Test API connection on load
        async function testApiConnection() {
            try {
                const health = await callApi('/api/health');
                console.log('API Health:', health);
                return true;
            } catch (error) {
                console.error('API Connection Failed:', error);
                showStatus('Connexion au serveur échouée', 'error');
                return false;
            }
        }

        // Reliable file upload
        async function uploadFile() {
            const file = fileInput.files[0];
            if (!file) {
                showStatus('Veuillez sélectionner un fichier', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                showStatus('Upload en cours...', 'loading');
                uploadBtn.disabled = true;
                
                const result = await callApi('/api/upload', 'POST', formData);
                showStatus('Upload réussi!', 'success');
                await loadFiles();
            } catch (error) {
                showStatus(`Er
